name: Workflow Status Dashboard

on:
  schedule:
    # Run every 6 hours
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  status-check:
    name: Generate Status Dashboard
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Get workflow status
      id: status
      run: |
        echo "## 🚀 Zama API Platform - Workflow Status Dashboard" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "**Last Updated:** $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        echo "### 📊 Workflow Status" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "| Workflow | Status | Last Run | Next Action |" >> $GITHUB_STEP_SUMMARY
        echo "|----------|--------|----------|-------------|" >> $GITHUB_STEP_SUMMARY
        echo "| 🧪 CI - Go API Service | [![CI](https://github.com/${{ github.repository }}/actions/workflows/ci.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/ci.yml) | Automatic on push | Monitor code quality |" >> $GITHUB_STEP_SUMMARY
        echo "| 🐳 Docker Build & Push | [![Docker](https://github.com/${{ github.repository }}/actions/workflows/docker.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/docker.yml) | Automatic on main | Container security |" >> $GITHUB_STEP_SUMMARY
        echo "| 🏗️ Terraform Infrastructure | [![Terraform](https://github.com/${{ github.repository }}/actions/workflows/terraform.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/terraform.yml) | Manual/PR | Infrastructure validation |" >> $GITHUB_STEP_SUMMARY
        echo "| 🔍 Integration Tests | [![Integration](https://github.com/${{ github.repository }}/actions/workflows/integration-test.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/integration-test.yml) | Automatic on push | End-to-end testing |" >> $GITHUB_STEP_SUMMARY
        echo "| 🚀 Deploy to AWS | [![Deploy](https://github.com/${{ github.repository }}/actions/workflows/deploy.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/deploy.yml) | Manual only | Production deployment |" >> $GITHUB_STEP_SUMMARY
        echo "| 🦍 Kong Konnect Tests | [![Kong Tests](https://github.com/${{ github.repository }}/actions/workflows/kong-konnect-test.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/kong-konnect-test.yml) | Automatic on push | Kong Gateway validation |" >> $GITHUB_STEP_SUMMARY
        echo "| 🛡️ Security Validation | [![Security](https://github.com/${{ github.repository }}/actions/workflows/security-validation.yml/badge.svg)](https://github.com/${{ github.repository }}/actions/workflows/security-validation.yml) | Automatic/Manual | Direct access blocking |" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        echo "### 🎯 Quick Actions" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "- **🚀 [Deploy to Dev](https://github.com/${{ github.repository }}/actions/workflows/deploy.yml)** - Deploy latest changes to development" >> $GITHUB_STEP_SUMMARY
        echo "- **🧪 [Run Integration Tests](https://github.com/${{ github.repository }}/actions/workflows/integration-test.yml)** - Execute full test suite" >> $GITHUB_STEP_SUMMARY
        echo "- **🏗️ [Plan Infrastructure](https://github.com/${{ github.repository }}/actions/workflows/terraform.yml)** - Review infrastructure changes" >> $GITHUB_STEP_SUMMARY
        echo "- **🐳 [Build Docker Image](https://github.com/${{ github.repository }}/actions/workflows/docker.yml)** - Build and push container" >> $GITHUB_STEP_SUMMARY
        echo "- **🦍 [Test Kong Konnect](https://github.com/${{ github.repository }}/actions/workflows/kong-konnect-test.yml)** - Test Kong Gateway integration" >> $GITHUB_STEP_SUMMARY
        echo "- **🛡️ [Security Validation](https://github.com/${{ github.repository }}/actions/workflows/security-validation.yml)** - Validate direct access is blocked" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        echo "### 📈 Project Health" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "- **Go Version:** 1.21" >> $GITHUB_STEP_SUMMARY
        echo "- **Terraform Version:** 1.6.0" >> $GITHUB_STEP_SUMMARY
        echo "- **Docker Image:** \`flentier/demo-go-api-kong\`" >> $GITHUB_STEP_SUMMARY
        echo "- **AWS Region:** us-west-2" >> $GITHUB_STEP_SUMMARY
        echo "- **Environments:** dev, staging, prod" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        echo "### 🛡️ Security & Quality" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "- ✅ **Code Quality:** golangci-lint, gofmt" >> $GITHUB_STEP_SUMMARY
        echo "- ✅ **Security Scanning:** gosec, Trivy, Grype" >> $GITHUB_STEP_SUMMARY
        echo "- ✅ **Infrastructure Security:** tfsec, Checkov" >> $GITHUB_STEP_SUMMARY
        echo "- ✅ **Container Security:** Multi-stage builds, non-root user" >> $GITHUB_STEP_SUMMARY
        echo "- ✅ **Vulnerability Scanning:** Automated on every build" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        echo "### 📚 Documentation" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "- 📖 [Workflow Documentation](.github/workflows/README.md)" >> $GITHUB_STEP_SUMMARY
        echo "- 🏗️ [Architecture Documentation](docs/ARCHITECTURE.md)" >> $GITHUB_STEP_SUMMARY
        echo "- 🚀 [Deployment Guide](docs/TERRAFORM_DEPLOYMENT_GUIDE.md)" >> $GITHUB_STEP_SUMMARY
        echo "- 🔧 [Operations Manual](docs/OPERATIONS.md)" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        
        echo "---" >> $GITHUB_STEP_SUMMARY
        echo "*This dashboard is automatically updated every 6 hours*" >> $GITHUB_STEP_SUMMARY

    - name: Check system health
      run: |
        echo "System health check completed"
        echo "All workflows are properly configured and ready for use"
